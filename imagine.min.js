window.console||(window.console=log(function(){}));var typeIsArray;typeIsArray=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)};var isElement,isNode;isNode=function(a){return"object"==typeof Node?a instanceof Node:a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},isElement=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName},function(){var a,b,c;for(a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"],++c;window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c,d,e;return c=(new Date).getTime(),e=Math.max(0,16-(c-a)),d=window.setTimeout(function(){b(c+e)},e),a=c+e,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var Imagine,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Imagine=function(){function a(b){return a.process(b)}return a.objects=[],a.process=function(b){var c,d,e;if("[object Array]"===Object.prototype.toString.call(b))for(d=0;d<b.length;)a.process(b[d]),d++;else isElement(b)?(c=new a.Element(b),e=a.process({}).addComponent(c)):e=a.engine.registerObject(b);return e},a.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},a.getComponent=function(b){var c,d,e,f,g;for(g=a.objects,e=0,f=g.length;f>e;e++)if(d=g[e],c=d.getComponent(b))return c},a.getComponents=function(b){var c,d,e,f,g,h;for(e=[],h=a.objects,f=0,g=h.length;g>f;f++)d=h[f],c=d.getComponent(b),c&&e.push(c);return e},a.notify=function(b){var c,d,e,f,g;for(f=a.objects,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.notify(b));return g},a.destroy=function(b){var c;return b=b._object||b,__indexOf.call(a.objects,b)>=0?(c=a.objects.indexOf(b),a.objects.splice(c,1)):void 0},a}(),Imagine.component={};var __indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Imagine.Engine=function(){function a(){setTimeout(this.init,0)}return a.prototype.fps=0,a.prototype.frameGap=1e3/a.fps,a.prototype.inited=!1,a.prototype.updateId=void 0,a.prototype.init=function(){var a;this.inited||(this.inited=!0,a=new Date,Imagine.time.startTime=a.getTime(),Imagine.time.lastTime=Imagine.time.startTime,Imagine.engine.setFPS(this.fps))},a.prototype.update=function(){var a,b,c,d;for(Imagine.time.update(),Imagine.Input.update(),b=0;b<Imagine.objects.length;){if(d=Imagine.objects[b],d._components)for(c in d._components)d._components.hasOwnProperty(c)&&(a=d._components[c],a.update&&a.update());b++}0===this.fps&&(this.updateId=requestAnimationFrame(this.update))},a.prototype.forceUpdate=function(){return this.update()},a.prototype.clearUpdate=function(){clearInterval(this.updateId),cancelAnimationFrame(this.updateId)},a.prototype.setFPS=function(a){this.fps=a,Imagine.engine.clearUpdate(),0===this.fps?(this.frameGap=0,this.updateId=requestAnimationFrame(this.update)):(this.frameGap=1e3/this.fps,this.updateId=setInterval(this.update,this.frameGap))},a.prototype.addComponent=function(a){var b,c,d,e,f,g,h,i,j;if(!a)return console.log("component not defined"),this;for(d=this._object||this,a._object=d,d._components||(d._components=[]),d._components.push(a),Imagine.engine.assignfunctions(a),i=d._components,e=0,g=i.length;g>e;e++)if(b=i[e],b._register)for(j=d._components,f=0,h=j.length;h>f;f++)c=j[f],c[b._register]||(c[b._register]=b);return a.start&&a.start(),a},a.prototype.getComponent=function(a){var b,c,d,e,f;if(c=this._object||this,c._components)for(f=c._components,d=0,e=f.length;e>d;d++)if(b=f[d],b.name===a)return b},a.prototype.getTag=function(a){var b,c,d,e,f,g,h,i,j;if(c=this._object||this,c._components)for(i=c._components,e=0,g=i.length;g>e;e++)if(b=i[e],b.tags)for(j=b.tags,f=0,h=j.length;h>f;f++)if(d=j[f],d===a)return b},a.prototype.addTag=function(a){return this.tags||(this.tags=[]),this.tags.push(a),this},a.prototype.hasTag=function(a){return __indexOf.call(this.tags,a)>=0},a.prototype.removeTag=function(){},a.prototype.notify=function(a,b){var c,d,e,f,g,h;if(d=this._object||this,d._components){for(g=d._components,h=[],e=0,f=g.length;f>e;e++)c=g[e],h.push(c[a]?"function"==typeof c[a]?c[a].apply(c,[b]):void 0:void 0);return h}},a.prototype.assignfunctions=function(a){var b,c,d,e,f;if(a.addComponent=this.addComponent,a.getComponent=this.getComponent,a.getTag=this.getTag,a.addTag=this.addTag,a.hasTag=this.hasTag,a.removeTag=this.removeTag,a.notify=this.notify,a.requireComponent){if(Imagine.utils.typeIsArray(a.requireComponent)){for(e=a.requireComponent,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(a.addComponent(new b));return f}return a.addComponent(new a.requireComponent)}},a.prototype.reset=function(){Imagine.objects=[],Imagine.Input.reset(),Imagine.time.paused=!1,this.inited=!1,this.clearUpdate(),this.init()},a.prototype.registerObject=function(a){var b,c;if(a._components=[a],Imagine.objects.push(a),Imagine.engine.assignfunctions(a),a.start&&a.start(),a.component)for(c in a.component)a.component.hasOwnProperty(c)&&(b=a.component[c],a.addComponent(b));return a},a.prototype.getFPS=function(){return this.fps},a}(),Imagine.engine=new Imagine.Engine,Imagine.InputAbstract=function(){function a(){Imagine.addEvent(document,"keypress",function(a){var b;a=a||window.event,b=a.keyCode?a.keyCode:a.charCode,Imagine.Input.keypress(b)}),Imagine.addEvent(document,"keyup",function(a){var b;a=a||window.event,b=a.keyCode?a.keyCode:a.charCode,Imagine.Input.keyup(b)}),Imagine.addEvent(document,"keydown",function(a){var b;a=a||window.event,b=a.keyCode?a.keyCode:a.charCode,Imagine.Input.keydown(b)}),this.init()}return a.prototype.axes={},a.prototype.mapping={},a.prototype.keyStatus={},a.prototype.keyChanging={},a.prototype.keyChanged={},a.prototype.keypress=function(){},a.prototype.keyup=function(a){var b,c,d,e,f,g;for(Imagine.notify("onKeyUp",a),a=this.map(a),this.keyStatus[a]=!1,this.keyChanging[a]="up",c=0;c<Imagine.objects.length;){if(d=Imagine.objects[c],d._components)for(g=d._components,e=0,f=g.length;f>e;e++)b=g[e],b.keyup&&b.keyup(a);c++}},a.prototype.keydown=function(a){var b,c,d,e,f,g,h;if(Imagine.notify("onKeyDown",a),a=this.map(a),c=!1,this.keyStatus.hasOwnProperty(a)?this.keyStatus[a]!==!0&&(c=!0,this.keyChanging[a]="down"):(c=!0,this.keyChanging[a]="down"),c)for(d=0;d<Imagine.objects.length;){if(e=Imagine.objects[d],e._components)for(h=e._components,f=0,g=h.length;g>f;f++)b=h[f],b.keydown&&b.keydown(a);d++}this.keyStatus[a]=!0},a.prototype.defaults={axes:{Horizontal:{positive:"right",negative:"left"},Vertical:{positive:"up",negative:"down"}},mapping:{left:37,up:38,right:39,down:40,shift:16,enter:13,ctrl:17,escape:27}},a.prototype.init=function(){this.config=JSON.parse(JSON.stringify(this.defaults)),this.axes=this.config.axes,this.mapping=this.config.mapping},a.prototype.reset=function(){this.keyStatus={},this.keyChanging={},this.keyChanged={}},a.prototype.map=function(a){return"number"==typeof a?a:this.mapping.hasOwnProperty(a)?this.mapping[a]:parseInt(a)},a.prototype.isDown=function(a){return a=this.map(a),this.keyStatus.hasOwnProperty(a)?this.keyStatus[a]:!1},a.prototype.getKey=function(a){return this.isDown(a)},a.prototype.getKeyDown=function(a){return a=this.map(a),this.keyChanged.hasOwnProperty(a)&&"down"===this.keyChanged[a]?!0:!1},a.prototype.getKeyUp=function(a){return a=this.map(a),this.keyChanged.hasOwnProperty(a)&&"up"===this.keyChanged[a]?!0:!1},a.prototype.getAxis=function(a){var b,c;return c=this.isDown(this.axes[a].positive),b=this.isDown(this.axes[a].negative),(c?1:0)+(b?-1:0)},a.prototype.update=function(){this.keyChanged=this.keyChanging,this.keyChanging={}},a.prototype.addAxis=function(a,b){this.axes[a]=b},a}(),Imagine.Input=new Imagine.InputAbstract,Imagine.TimeAbstract=function(){function a(){}return a.prototype.paused=!1,a.prototype.deltaTime=0,a.prototype.currentTime=0,a.prototype.lastTime=0,a.prototype.startTime=0,a.prototype.pause=function(a){return(a||!a)&&(this.paused=!this.paused),this.paused?Imagine.engine.clearUpdate():Imagine.engine.setFPS(Imagine.engine.getFPS())},a.prototype.update=function(){var a,b;return a=new Date,b=a.getTime(),Imagine.time.currentTime=b-Imagine.time.startTime,Imagine.time.deltaTime=(b-Imagine.time.lastTime)/1e3,Imagine.time.lastTime=b},a}(),Imagine.time=new Imagine.TimeAbstract,Imagine.Utils=function(){function a(){}return a.prototype.typeIsArray=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},a}(),Imagine.utils=new Imagine.Utils,Imagine.FPS=function(){function a(){}return a.prototype.lastFPS=[],a.prototype.update=function(){var a,b,c,d,e;if(this.lastFPS.push(1/Imagine.time.deltaTime),this.lastFPS.length>10){for(a=0,e=this.lastFPS,c=0,d=e.length;d>c;c++)b=e[c],a+=b;return a=Math.floor(a/this.lastFPS.length),this.lastFPS=[],$(this.element.raw).html(a+"FPS")}},a}();var __indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Imagine.Collider=function(){function a(){}return a.prototype.ignoreSides=[],a.prototype.name="collider",a.prototype.tags=["collider"],a.prototype._register="collider",a.prototype.isTrigger=!1,a.prototype.start=function(){this.element=this.getComponent("element")},a.prototype.move=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(k=this.element.raw.getBoundingClientRect(),c={top:k.top,right:k.right,bottom:k.bottom,left:k.left},0>b?c.top+=b:c.bottom+=b,0>a?c.left+=a:c.right+=a,g=Imagine.getComponents("collider"),f=[],n=0,p=g.length;p>n;n++)d=g[n],this!==d&&(h=d.getComponent("element"),h&&(j=h.raw.getBoundingClientRect(),this.compareSquares(c,j)&&(e={side:[],collider:d},i=k.height||k.bottom-k.top,m=k.width||k.right-k.left,k.bottom<=j.top&&c.bottom>j.top&&!(__indexOf.call(d.ignoreSides,"top")>=0)?(this.isTrigger||d.isTrigger||(b=j.top-i-c.top),e.side.push("top")):j.bottom<=k.top&&c.top<j.bottom&&!(__indexOf.call(d.ignoreSides,"bottom")>=0)&&(this.isTrigger||d.isTrigger||(b=j.bottom-k.top),e.side.push("bottom")),k.right<=j.left&&c.right>j.left&&!(__indexOf.call(d.ignoreSides,"left")>=0)?(this.isTrigger||d.isTrigger||(a=j.left-m-c.left),e.side.push("left")):j.right<=k.left&&c.left<j.right&&!(__indexOf.call(d.ignoreSides,"right")>=0)&&(this.isTrigger||d.isTrigger||(a=j.right-k.left),e.side.push("right")),e.side.length>0&&f.push(e))));for(this.element.move(a,b),o=0,q=f.length;q>o;o++)d=f[o],this.notify("onCollision",d),l=d.side.map(function(a){switch(a){case"left":return"right";case"right":return"left";case"top":return"bottom";case"bottom":return"top"}}),d.collider.notify("onCollision",{side:l,collider:this});switch(f.length){case 0:return;case 1:return f[0];default:return l=f.map(function(a){return a.side[0]}),{side:l,collisions:f}}},a.prototype.collidesWith=function(a){var b,c;return b=this.element.getBoundingClientRect(),c=a.getBoundingClientRect(),this.compareSquares(b,c)},a.prototype.compareSquares=function(a,b){var c,d;return c=a.bottom<=b.top||b.bottom<=a.top,d=a.right<=b.left||b.right<=a.left,!d&&!c},a}(),Imagine.Element=function(){function a(a){if(this.raw=a,!isElement(this.raw))throw new Error("Not a HTML object");this.raw.getLocalRect=this.getLocalRect,this.raw.move=this.move,this.raw.moveTo=this.moveTo}return a.prototype.name="element",a.prototype.tags=["element"],a.prototype._register="element",a.prototype.getLocalRect=function(){var a,b,c;return c=this.raw.getBoundingClientRect(),a=this.raw.parentNode,a&&(b=a.getBoundingClientRect(),c={right:c.right-b.left,bottom:c.bottom-b.top,top:c.top-b.top,left:c.left-b.left,height:c.bottom-c.top,width:c.right-c.left}),c},a.prototype.posInit=function(){return this._pos={left:this.raw.offsetLeft,top:this.raw.offsetTop}},a.prototype.getPosition=function(){return this._pos||this.posInit(),this._pos},a.prototype.setPosition=function(a,b){return this._pos={left:a,top:b},this.raw.style.top=b+"px",this.raw.style.left=a+"px",this},a.prototype.moveTo=function(a,b){return this.setPosition(a,b)},a.prototype.move=function(a,b){var c;return c=this.getPosition(),this.setPosition(c.left+a,c.top+b)},a}();